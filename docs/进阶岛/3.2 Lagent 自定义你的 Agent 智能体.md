# 3.2 Lagent 自定义你的 Agent 智能体

![alt text](image.png)

## 一、任务说明

### 1.基础任务

- 使用 Lagent 自定义一个智能体，并使用 Lagent Web Demo 成功部署与调用，记录复现过程并截图。

### 2.进阶任务


## 二、任务提交

### 基础任务

### 进阶任务

## 三、复现步骤

### 3.1 环境配置

开发机选择 30% A100，镜像选择为 Cuda12.2-conda。

``` bash
# 创建环境
conda create -n agent_camp3 python=3.10 -y
# 激活环境
conda activate agent_camp3
# 安装 torch
conda install pytorch==2.1.2 torchvision==0.16.2 torchaudio==2.1.2 pytorch-cuda=12.1 -c pytorch -c nvidia -y
# 安装其他依赖包
pip install termcolor==2.4.0
pip install lmdeploy==0.5.2
```

### 3.2 lagent源码安装

``` bash
# 创建目录以存放代码
mkdir -p /root/agent_camp3
cd /root/agent_camp3
git clone https://github.com/InternLM/lagent.git
cd lagent && git checkout 81e7ace && pip install -e . && cd ..
```

### 3.3 lagent web UI

- LMDeploy 部署 InternLM2.5-7B-Chat，启动一个 API Server。

```bash
conda activate agent_camp3
lmdeploy serve api_server /share/new_models/Shanghai_AI_Laboratory/internlm2_5-7b-chat --model-name internlm2_5-7b-chat
```

- 另启一个窗口，运行 Lagent 的 Web Demo。

```bash 
cd /root/agent_camp3/lagent
conda activate agent_camp3
streamlit run examples/internlm2_agent_web_demo.py
```

### 3.4 本地访问验证

- 端口映射

```bash
ssh -CNg -L 8501:127.0.0.1:8501 -L 23333:127.0.0.1:23333 root@ssh.intern-ai.org.cn -p <你的 SSH 端口号>
```
- 访问 Web Demo

在本地浏览器中打开 localhost:8501，并修改模型名称一栏为 internlm2_5-7b-chat，修改模型 ip一栏为127.0.0.1:23333


